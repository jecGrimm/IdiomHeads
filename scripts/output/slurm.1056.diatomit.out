slurmstepd-diatomit: error: Unable to create TMPDIR [/tmp/user/32202]: Permission denied
slurmstepd-diatomit: error: Setting TMPDIR to /tmp
/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/transformers/tokenization_utils_base.py:1601: FutureWarning: `clean_up_tokenization_spaces` was not set. It will be set to `True` by default. This behavior will be depracted in transformers v4.45, and will be then set to `False` by default. For more details check this issue: https://github.com/huggingface/transformers/issues/31884
  warnings.warn(
WARNING:root:With reduced precision, it is advised to use `from_pretrained_no_processing` instead of `from_pretrained`.
Loaded pretrained model EleutherAI/pythia-1.4b into HookedTransformer

Model uses LayerNorm!

Running logit attribution on device cuda.

Processing split:  formal
Map:   0%|          | 0/2760 [00:00<?, ? examples/s]
Computing logit attribution for the following components:
['L0H0', 'L0H1', 'L0H2', 'L0H3', 'L0H4', 'L0H5', 'L0H6', 'L0H7', 'L0H8', 'L0H9', 'L0H10', 'L0H11', 'L0H12', 'L0H13', 'L0H14', 'L0H15', 'L1H0', 'L1H1', 'L1H2', 'L1H3', 'L1H4', 'L1H5', 'L1H6', 'L1H7', 'L1H8', 'L1H9', 'L1H10', 'L1H11', 'L1H12', 'L1H13', 'L1H14', 'L1H15', 'L2H0', 'L2H1', 'L2H2', 'L2H3', 'L2H4', 'L2H5', 'L2H6', 'L2H7', 'L2H8', 'L2H9', 'L2H10', 'L2H11', 'L2H12', 'L2H13', 'L2H14', 'L2H15', 'L3H0', 'L3H1', 'L3H2', 'L3H3', 'L3H4', 'L3H5', 'L3H6', 'L3H7', 'L3H8', 'L3H9', 'L3H10', 'L3H11', 'L3H12', 'L3H13', 'L3H14', 'L3H15', 'L4H0', 'L4H1', 'L4H2', 'L4H3', 'L4H4', 'L4H5', 'L4H6', 'L4H7', 'L4H8', 'L4H9', 'L4H10', 'L4H11', 'L4H12', 'L4H13', 'L4H14', 'L4H15', 'L5H0', 'L5H1', 'L5H2', 'L5H3', 'L5H4', 'L5H5', 'L5H6', 'L5H7', 'L5H8', 'L5H9', 'L5H10', 'L5H11', 'L5H12', 'L5H13', 'L5H14', 'L5H15', 'L6H0', 'L6H1', 'L6H2', 'L6H3', 'L6H4', 'L6H5', 'L6H6', 'L6H7', 'L6H8', 'L6H9', 'L6H10', 'L6H11', 'L6H12', 'L6H13', 'L6H14', 'L6H15', 'L7H0', 'L7H1', 'L7H2', 'L7H3', 'L7H4', 'L7H5', 'L7H6', 'L7H7', 'L7H8', 'L7H9', 'L7H10', 'L7H11', 'L7H12', 'L7H13', 'L7H14', 'L7H15', 'L8H0', 'L8H1', 'L8H2', 'L8H3', 'L8H4', 'L8H5', 'L8H6', 'L8H7', 'L8H8', 'L8H9', 'L8H10', 'L8H11', 'L8H12', 'L8H13', 'L8H14', 'L8H15', 'L9H0', 'L9H1', 'L9H2', 'L9H3', 'L9H4', 'L9H5', 'L9H6', 'L9H7', 'L9H8', 'L9H9', 'L9H10', 'L9H11', 'L9H12', 'L9H13', 'L9H14', 'L9H15', 'L10H0', 'L10H1', 'L10H2', 'L10H3', 'L10H4', 'L10H5', 'L10H6', 'L10H7', 'L10H8', 'L10H9', 'L10H10', 'L10H11', 'L10H12', 'L10H13', 'L10H14', 'L10H15', 'L11H0', 'L11H1', 'L11H2', 'L11H3', 'L11H4', 'L11H5', 'L11H6', 'L11H7', 'L11H8', 'L11H9', 'L11H10', 'L11H11', 'L11H12', 'L11H13', 'L11H14', 'L11H15', 'L12H0', 'L12H1', 'L12H2', 'L12H3', 'L12H4', 'L12H5', 'L12H6', 'L12H7', 'L12H8', 'L12H9', 'L12H10', 'L12H11', 'L12H12', 'L12H13', 'L12H14', 'L12H15', 'L13H0', 'L13H1', 'L13H2', 'L13H3', 'L13H4', 'L13H5', 'L13H6', 'L13H7', 'L13H8', 'L13H9', 'L13H10', 'L13H11', 'L13H12', 'L13H13', 'L13H14', 'L13H15', 'L14H0', 'L14H1', 'L14H2', 'L14H3', 'L14H4', 'L14H5', 'L14H6', 'L14H7', 'L14H8', 'L14H9', 'L14H10', 'L14H11', 'L14H12', 'L14H13', 'L14H14', 'L14H15', 'L15H0', 'L15H1', 'L15H2', 'L15H3', 'L15H4', 'L15H5', 'L15H6', 'L15H7', 'L15H8', 'L15H9', 'L15H10', 'L15H11', 'L15H12', 'L15H13', 'L15H14', 'L15H15', 'L16H0', 'L16H1', 'L16H2', 'L16H3', 'L16H4', 'L16H5', 'L16H6', 'L16H7', 'L16H8', 'L16H9', 'L16H10', 'L16H11', 'L16H12', 'L16H13', 'L16H14', 'L16H15', 'L17H0', 'L17H1', 'L17H2', 'L17H3', 'L17H4', 'L17H5', 'L17H6', 'L17H7', 'L17H8', 'L17H9', 'L17H10', 'L17H11', 'L17H12', 'L17H13', 'L17H14', 'L17H15', 'L18H0', 'L18H1', 'L18H2', 'L18H3', 'L18H4', 'L18H5', 'L18H6', 'L18H7', 'L18H8', 'L18H9', 'L18H10', 'L18H11', 'L18H12', 'L18H13', 'L18H14', 'L18H15', 'L19H0', 'L19H1', 'L19H2', 'L19H3', 'L19H4', 'L19H5', 'L19H6', 'L19H7', 'L19H8', 'L19H9', 'L19H10', 'L19H11', 'L19H12', 'L19H13', 'L19H14', 'L19H15', 'L20H0', 'L20H1', 'L20H2', 'L20H3', 'L20H4', 'L20H5', 'L20H6', 'L20H7', 'L20H8', 'L20H9', 'L20H10', 'L20H11', 'L20H12', 'L20H13', 'L20H14', 'L20H15', 'L21H0', 'L21H1', 'L21H2', 'L21H3', 'L21H4', 'L21H5', 'L21H6', 'L21H7', 'L21H8', 'L21H9', 'L21H10', 'L21H11', 'L21H12', 'L21H13', 'L21H14', 'L21H15', 'L22H0', 'L22H1', 'L22H2', 'L22H3', 'L22H4', 'L22H5', 'L22H6', 'L22H7', 'L22H8', 'L22H9', 'L22H10', 'L22H11', 'L22H12', 'L22H13', 'L22H14', 'L22H15', 'L23H0', 'L23H1', 'L23H2', 'L23H3', 'L23H4', 'L23H5', 'L23H6', 'L23H7', 'L23H8', 'L23H9', 'L23H10', 'L23H11', 'L23H12', 'L23H13', 'L23H14', 'L23H15', '0_mlp_out', '1_mlp_out', '2_mlp_out', '3_mlp_out', '4_mlp_out', '5_mlp_out', '6_mlp_out', '7_mlp_out', '8_mlp_out', '9_mlp_out', '10_mlp_out', '11_mlp_out', '12_mlp_out', '13_mlp_out', '14_mlp_out', '15_mlp_out', '16_mlp_out', '17_mlp_out', '18_mlp_out', '19_mlp_out', '20_mlp_out', '21_mlp_out', '22_mlp_out', '23_mlp_out', 'embed', 'bias']
Map:   0%|          | 1/2760 [00:00<22:39,  2.03 examples/s]Map:   0%|          | 2/2760 [00:00<13:34,  3.39 examples/s]Map:   0%|          | 3/2760 [00:00<10:04,  4.56 examples/s]Map:   0%|          | 4/2760 [00:01<11:06,  4.13 examples/s]Map:   0%|          | 5/2760 [00:01<10:14,  4.48 examples/s]Map:   0%|          | 6/2760 [00:01<08:42,  5.27 examples/s]Map:   0%|          | 7/2760 [00:01<08:06,  5.66 examples/s]Map:   0%|          | 8/2760 [00:01<07:48,  5.88 examples/s]Map:   0%|          | 9/2760 [00:01<07:13,  6.35 examples/s]Map:   0%|          | 10/2760 [00:01<07:17,  6.28 examples/s]Map:   0%|          | 11/2760 [00:02<09:19,  4.91 examples/s]Map:   0%|          | 12/2760 [00:02<08:51,  5.17 examples/s]Map:   0%|          | 13/2760 [00:02<08:18,  5.51 examples/s]Map:   1%|          | 14/2760 [00:02<08:06,  5.65 examples/s]Map:   1%|          | 15/2760 [00:02<07:57,  5.74 examples/s]Map:   1%|          | 16/2760 [00:03<08:45,  5.22 examples/s]Map:   1%|          | 17/2760 [00:03<08:05,  5.65 examples/s]Map:   1%|          | 18/2760 [00:03<11:30,  3.97 examples/s]Map:   1%|          | 19/2760 [00:03<09:49,  4.65 examples/s]Map:   1%|          | 20/2760 [00:04<08:49,  5.17 examples/s]Map:   1%|          | 21/2760 [00:04<07:58,  5.73 examples/s]Map:   1%|          | 22/2760 [00:04<07:20,  6.22 examples/s]Map:   1%|          | 23/2760 [00:04<08:01,  5.69 examples/s]Map:   1%|          | 24/2760 [00:04<07:30,  6.07 examples/s]Map:   1%|          | 25/2760 [00:04<07:04,  6.44 examples/s]Map:   1%|          | 26/2760 [00:04<07:27,  6.11 examples/s]Map:   1%|          | 27/2760 [00:05<07:21,  6.19 examples/s]Map:   1%|          | 28/2760 [00:05<08:10,  5.57 examples/s]Map:   1%|          | 29/2760 [00:05<08:33,  5.31 examples/s]Map:   1%|          | 30/2760 [00:05<07:50,  5.80 examples/s]Map:   1%|          | 31/2760 [00:05<07:11,  6.33 examples/s]Map:   1%|          | 32/2760 [00:05<07:00,  6.49 examples/s]Map:   1%|          | 33/2760 [00:06<06:42,  6.78 examples/s]Map:   1%|          | 34/2760 [00:06<06:32,  6.94 examples/s]Map:   1%|▏         | 35/2760 [00:06<07:04,  6.42 examples/s]Map:   1%|▏         | 36/2760 [00:06<06:46,  6.69 examples/s]Map:   1%|▏         | 37/2760 [00:06<06:19,  7.18 examples/s]Map:   1%|▏         | 38/2760 [00:06<05:58,  7.60 examples/s]Map:   1%|▏         | 39/2760 [00:06<06:09,  7.36 examples/s]Map:   1%|▏         | 40/2760 [00:07<09:13,  4.92 examples/s]Map:   1%|▏         | 41/2760 [00:07<10:29,  4.32 examples/s]Map:   2%|▏         | 42/2760 [00:07<09:27,  4.79 examples/s]Map:   2%|▏         | 43/2760 [00:07<09:39,  4.69 examples/s]Map:   2%|▏         | 44/2760 [00:08<08:42,  5.20 examples/s]Map:   2%|▏         | 45/2760 [00:08<08:02,  5.63 examples/s]Map:   2%|▏         | 46/2760 [00:08<07:16,  6.21 examples/s]Map:   2%|▏         | 47/2760 [00:08<07:17,  6.20 examples/s]Map:   2%|▏         | 48/2760 [00:08<07:06,  6.35 examples/s]Map:   2%|▏         | 49/2760 [00:08<06:32,  6.90 examples/s]Map:   2%|▏         | 50/2760 [00:08<06:18,  7.16 examples/s]Map:   2%|▏         | 51/2760 [00:09<08:07,  5.56 examples/s]Map:   2%|▏         | 52/2760 [00:09<07:19,  6.17 examples/s]Map:   2%|▏         | 53/2760 [00:09<06:43,  6.71 examples/s]Map:   2%|▏         | 54/2760 [00:09<06:27,  6.98 examples/s]Map:   2%|▏         | 55/2760 [00:09<06:20,  7.10 examples/s]Map:   2%|▏         | 56/2760 [00:09<06:43,  6.70 examples/s]Map:   2%|▏         | 57/2760 [00:09<06:31,  6.91 examples/s]Map:   2%|▏         | 58/2760 [00:10<07:00,  6.43 examples/s]Map:   2%|▏         | 59/2760 [00:10<07:54,  5.69 examples/s]Map:   2%|▏         | 60/2760 [00:10<07:35,  5.93 examples/s]Map:   2%|▏         | 61/2760 [00:10<07:12,  6.24 examples/s]Map:   2%|▏         | 62/2760 [00:10<08:55,  5.03 examples/s]Map:   2%|▏         | 63/2760 [00:11<08:00,  5.61 examples/s]Map:   2%|▏         | 64/2760 [00:11<07:37,  5.90 examples/s]Map:   2%|▏         | 65/2760 [00:11<07:28,  6.00 examples/s]Map:   2%|▏         | 66/2760 [00:11<08:13,  5.46 examples/s]Map:   2%|▏         | 67/2760 [00:11<07:34,  5.93 examples/s]Map:   2%|▏         | 68/2760 [00:11<07:23,  6.07 examples/s]Map:   2%|▎         | 69/2760 [00:12<06:53,  6.50 examples/s]Map:   3%|▎         | 70/2760 [00:12<08:59,  4.98 examples/s]Map:   3%|▎         | 71/2760 [00:12<08:54,  5.04 examples/s]Map:   3%|▎         | 72/2760 [00:12<07:47,  5.75 examples/s]Map:   3%|▎         | 73/2760 [00:12<07:23,  6.06 examples/s]Map:   3%|▎         | 74/2760 [00:12<07:14,  6.19 examples/s]Map:   3%|▎         | 75/2760 [00:13<07:19,  6.11 examples/s]Map:   3%|▎         | 76/2760 [00:13<07:44,  5.77 examples/s]Map:   3%|▎         | 77/2760 [00:13<07:14,  6.18 examples/s]Map:   3%|▎         | 78/2760 [00:13<06:47,  6.57 examples/s]Map:   3%|▎         | 79/2760 [00:13<06:21,  7.02 examples/s]Map:   3%|▎         | 80/2760 [00:13<06:05,  7.34 examples/s]Map:   3%|▎         | 81/2760 [00:13<06:35,  6.78 examples/s]Map:   3%|▎         | 82/2760 [00:14<07:05,  6.29 examples/s]Map:   3%|▎         | 83/2760 [00:14<07:03,  6.33 examples/s]Map:   3%|▎         | 84/2760 [00:14<09:04,  4.91 examples/s]Map:   3%|▎         | 85/2760 [00:14<08:15,  5.40 examples/s]Map:   3%|▎         | 86/2760 [00:14<08:36,  5.18 examples/s]Map:   3%|▎         | 87/2760 [00:15<08:43,  5.10 examples/s]Map:   3%|▎         | 88/2760 [00:15<08:12,  5.43 examples/s]Map:   3%|▎         | 89/2760 [00:15<07:37,  5.83 examples/s]Map:   3%|▎         | 90/2760 [00:15<07:12,  6.17 examples/s]Map:   3%|▎         | 91/2760 [00:15<07:14,  6.15 examples/s]Map:   3%|▎         | 92/2760 [00:15<06:46,  6.57 examples/s]Map:   3%|▎         | 93/2760 [00:16<07:51,  5.66 examples/s]Map:   3%|▎         | 94/2760 [00:16<08:22,  5.30 examples/s]Map:   3%|▎         | 95/2760 [00:16<08:53,  5.00 examples/s]Map:   3%|▎         | 96/2760 [00:16<08:10,  5.43 examples/s]Map:   4%|▎         | 97/2760 [00:17<11:32,  3.85 examples/s]Map:   4%|▎         | 98/2760 [00:17<10:04,  4.40 examples/s]Map:   4%|▎         | 99/2760 [00:17<08:50,  5.02 examples/s]Map:   4%|▎         | 100/2760 [00:17<10:37,  4.17 examples/s]Map:   4%|▎         | 101/2760 [00:17<09:57,  4.45 examples/s]Map:   4%|▎         | 102/2760 [00:18<08:46,  5.05 examples/s]Map:   4%|▎         | 103/2760 [00:18<08:01,  5.52 examples/s]Map:   4%|▍         | 104/2760 [00:18<09:29,  4.66 examples/s]Map:   4%|▍         | 105/2760 [00:18<08:32,  5.18 examples/s]Map:   4%|▍         | 106/2760 [00:18<07:34,  5.83 examples/s]Map:   4%|▍         | 107/2760 [00:19<08:03,  5.48 examples/s]Map:   4%|▍         | 108/2760 [00:19<08:10,  5.40 examples/s]Map:   4%|▍         | 109/2760 [00:19<08:50,  5.00 examples/s]Map:   4%|▍         | 110/2760 [00:19<09:01,  4.89 examples/s]Map:   4%|▍         | 111/2760 [00:19<09:14,  4.78 examples/s]Map:   4%|▍         | 112/2760 [00:20<08:39,  5.10 examples/s]Map:   4%|▍         | 113/2760 [00:20<08:22,  5.27 examples/s]Map:   4%|▍         | 114/2760 [00:20<07:51,  5.62 examples/s]Map:   4%|▍         | 115/2760 [00:20<08:09,  5.40 examples/s]Map:   4%|▍         | 116/2760 [00:20<08:00,  5.51 examples/s]Map:   4%|▍         | 117/2760 [00:21<08:41,  5.07 examples/s]Map:   4%|▍         | 118/2760 [00:21<09:23,  4.69 examples/s]Map:   4%|▍         | 119/2760 [00:21<09:17,  4.73 examples/s]Map:   4%|▍         | 120/2760 [00:21<08:06,  5.43 examples/s]Map:   4%|▍         | 121/2760 [00:21<08:18,  5.29 examples/s]Map:   4%|▍         | 122/2760 [00:21<07:52,  5.58 examples/s]Map:   4%|▍         | 123/2760 [00:22<08:04,  5.44 examples/s]Map:   4%|▍         | 124/2760 [00:22<08:33,  5.13 examples/s]Map:   5%|▍         | 125/2760 [00:22<08:46,  5.01 examples/s]Map:   5%|▍         | 126/2760 [00:22<10:09,  4.32 examples/s]Map:   5%|▍         | 127/2760 [00:23<09:11,  4.77 examples/s]Map:   5%|▍         | 128/2760 [00:23<08:32,  5.13 examples/s]Map:   5%|▍         | 129/2760 [00:23<08:11,  5.35 examples/s]Map:   5%|▍         | 130/2760 [00:23<08:31,  5.14 examples/s]Map:   5%|▍         | 131/2760 [00:23<08:39,  5.06 examples/s]Map:   5%|▍         | 132/2760 [00:24<12:48,  3.42 examples/s]Map:   5%|▍         | 133/2760 [00:24<13:23,  3.27 examples/s]Map:   5%|▍         | 134/2760 [00:24<11:10,  3.91 examples/s]Map:   5%|▍         | 135/2760 [00:24<09:55,  4.41 examples/s]Map:   5%|▍         | 136/2760 [00:25<08:31,  5.13 examples/s]Map:   5%|▍         | 137/2760 [00:25<08:55,  4.90 examples/s]Map:   5%|▌         | 138/2760 [00:25<08:48,  4.96 examples/s]Map:   5%|▌         | 139/2760 [00:25<07:42,  5.67 examples/s]Map:   5%|▌         | 140/2760 [00:25<07:41,  5.68 examples/s]Map:   5%|▌         | 141/2760 [00:25<07:12,  6.05 examples/s]Map:   5%|▌         | 142/2760 [00:26<07:30,  5.81 examples/s]Map:   5%|▌         | 143/2760 [00:26<06:54,  6.31 examples/s]Map:   5%|▌         | 144/2760 [00:26<07:06,  6.13 examples/s]Map:   5%|▌         | 145/2760 [00:26<06:47,  6.41 examples/s]Map:   5%|▌         | 146/2760 [00:26<06:29,  6.71 examples/s]Map:   5%|▌         | 147/2760 [00:26<07:10,  6.06 examples/s]Map:   5%|▌         | 148/2760 [00:27<08:16,  5.26 examples/s]Map:   5%|▌         | 149/2760 [00:27<07:49,  5.56 examples/s]Map:   5%|▌         | 150/2760 [00:27<07:29,  5.80 examples/s]Map:   5%|▌         | 150/2760 [00:27<08:01,  5.42 examples/s]
Traceback (most recent call last):
  File "/home/g/grimmj/IdiomHeads/compute_logit_attr.py", line 45, in <module>
    data.map(lambda batch: scorer.compute_logit_attr_batched(batch, grouped_file), batched=True, batch_size = batch_size)
  File "/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 562, in wrapper
    out: Union["Dataset", "DatasetDict"] = func(self, *args, **kwargs)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3079, in map
    for rank, done, content in Dataset._map_single(**dataset_kwargs):
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3519, in _map_single
    for i, batch in iter_outputs(shard_iterable):
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3469, in iter_outputs
    yield i, apply_function(example, i, offset=offset)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/miniconda3/envs/idiom/lib/python3.12/site-packages/datasets/arrow_dataset.py", line 3392, in apply_function
    processed_inputs = function(*fn_args, *additional_args, **fn_kwargs)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/IdiomHeads/compute_logit_attr.py", line 45, in <lambda>
    data.map(lambda batch: scorer.compute_logit_attr_batched(batch, grouped_file), batched=True, batch_size = batch_size)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/IdiomHeads/logit_attribution.py", line 115, in compute_logit_attr_batched
    batch_split_attr[i] = self.split_logit_attribution(sent_score, idiom_pos)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/g/grimmj/IdiomHeads/logit_attribution.py", line 70, in split_logit_attribution
    return t.vstack((idiom_attr, literal_attr))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: Expected all tensors to be on the same device, but found at least two devices, cuda:0 and cpu! (when checking argument for argument tensors in method wrapper_CUDA_cat)
